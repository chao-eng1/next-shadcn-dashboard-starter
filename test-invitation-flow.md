# 项目邀请功能测试计划

## 数据库准备

首先需要运行数据库迁移以添加新的邀请模型：

```bash
# 生成迁移文件
npx prisma migrate dev --name add-project-invitations

# 如果不需要执行完整迁移，也可以直接应用更新的schema
npx prisma db push
```

## 功能测试流程

### 1. 邀请发送测试

#### 1.1 邀请发送权限测试

- 使用项目所有者账号登录
  - 应该能够成功访问项目团队页面
  - 应该能够成功发送邀请
- 使用管理员账号登录
  - 应该能够成功访问项目团队页面
  - 应该能够成功发送邀请
- 使用普通成员账号登录
  - 应该能够查看项目团队页面
  - 应该不能发送邀请（邀请按钮不可见或被禁用）
- 使用观察者账号登录
  - 应该能够查看项目团队页面
  - 应该不能发送邀请（邀请按钮不可见或被禁用）

#### 1.2 邀请表单验证测试

- 尝试发送空邮箱
  - 应该显示邮箱验证错误
- 尝试发送无效邮箱格式
  - 应该显示邮箱格式验证错误
- 尝试邀请已经是项目成员的用户
  - 应该显示相应的错误消息
- 尝试发送新的有效邀请
  - 应该成功创建邀请记录
  - 应该在邀请列表中显示新邀请

### 2. 邀请管理测试

#### 2.1 邀请列表展示测试

- 查看邀请列表
  - 应该能够正确显示所有邀请及其状态
  - 待处理邀请应该突出显示
  - 应该显示邀请的角色、接收邮箱等关键信息

#### 2.2 邀请操作测试

- 取消待处理邀请
  - 应该将邀请状态变更为已拒绝
  - 邀请列表应该更新状态
- 重新发送过期邀请
  - 应该刷新邀请令牌和过期时间
  - 邀请状态应该变更为待处理
- 删除邀请记录
  - 应该从数据库中删除邀请记录
  - 邀请应该从列表中消失

### 3. 邀请接受/拒绝流程测试

#### 3.1 邀请链接访问测试

- 未登录用户访问邀请链接
  - 应该重定向到登录页面
  - 登录后应该自动跳转回邀请页面
- 已登录用户访问邀请链接
  - 非邀请接收者邮箱登录
    - 应该显示邮箱不匹配的错误提示
  - 邀请接收者邮箱登录
    - 应该显示项目和邀请详情

#### 3.2 邀请状态检查测试

- 访问已过期邀请链接
  - 应该显示邀请已过期的提示
  - 接受/拒绝按钮应该被禁用
- 访问已处理邀请链接
  - 已接受的邀请应显示已接受状态
  - 已拒绝的邀请应显示已拒绝状态
  - 接受/拒绝按钮应该被禁用

#### 3.3 邀请响应测试

- 接受邀请
  - 应该成功创建项目成员记录
  - 邀请状态应该变更为已接受
  - 应该重定向到项目详情页面
- 拒绝邀请
  - 应该显示确认对话框
  - 确认后邀请状态应该变更为已拒绝
  - 应该重定向到仪表盘

### 4. 边界情况测试

- 邀请已是项目成员的用户
  - 系统应该检测并提示用户已是成员
- 邀请过程中项目被删除
  - 访问邀请链接应该显示项目不存在提示
- 多个邀请发送到同一邮箱
  - 系统应该检测并阻止重复发送待处理邀请
- 邀请链接被多次使用
  - 第一次使用后，后续使用应该显示邀请已处理
- 大量邀请测试
  - 确保邀请列表在数量较多时仍能正常加载和分页

## 安全测试

- 尝试伪造邀请令牌
  - 系统应该验证令牌有效性，无效令牌请求应该返回404
- 尝试访问其他项目的邀请管理页面
  - 未授权用户应该被重定向或显示权限错误
- 尝试使用API直接操作非自己创建的邀请
  - API应该验证权限并拒绝未授权操作

## 性能测试

- 邀请列表加载时间
  - 在有10/50/100个邀请的情况下测试列表加载性能
- 邀请发送响应时间
  - 确保邀请发送操作响应速度在可接受范围内
- 邀请接受/拒绝操作响应时间
  - 确保接受/拒绝操作响应速度在可接受范围内

## 用户体验测试

- 邀请发送表单易用性
  - 确保表单填写和提交过程流畅
- 邀请列表可读性
  - 确保邀请状态、操作等信息清晰可见
- 邀请页面在不同设备上的响应式表现
  - 测试桌面、平板和移动设备上的显示效果
- 邀请接受/拒绝页面直观性
  - 确保用户容易理解项目信息和邀请详情
  - 确保操作按钮清晰可见

## 兼容性测试

- 邀请链接在不同浏览器中的兼容性
  - 测试Chrome、Firefox、Safari、Edge等主流浏览器
- 邀请页面在不同操作系统上的兼容性
  - 测试Windows、macOS、iOS、Android等平台

## 回归测试

- 确保邀请功能不影响现有的项目管理功能
  - 项目创建、编辑、查看等基本功能仍然正常工作
  - 任务管理、文档等子功能正常工作
- 确保权限系统正常工作
  - 项目权限控制仍然有效
  - 新增的邀请相关权限正确应用

## 用户文档

创建以下用户文档：

- 邀请功能介绍
- 如何邀请新成员
- 如何管理项目邀请
- 如何接受或拒绝邀请
- 常见问题解答
